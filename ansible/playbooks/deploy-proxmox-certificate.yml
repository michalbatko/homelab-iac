- name: Deploy certificate to Proxmox via API
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Show execution context
      shell: |
        echo "Hostname: $(hostname)"
        echo "User: $(whoami)"
        echo "Working directory: $(pwd)"
      register: context_info

    - name: Display execution context
      debug:
        var: context_info.stdout_lines

    - name: Load Proxmox API credentials
      debug:
        msg: "TODO: Load API token from {{ proxmox_api_token_file | default('/etc/letsencrypt/proxmox-api-token.ini') }}"

    - name: Read certificate files from disk
      debug:
        msg: "TODO: Read cert.pem and privkey.pem for {{ item.domain }} from /etc/letsencrypt/live/"
      loop: "{{ proxmox_certificates }}"

    - name: Upload certificates via Proxmox API
      debug:
        msg: "TODO: POST certificate data to {{ item.api_endpoint }}/api2/json/nodes/.../certificates/custom for {{ item.domain }}"
      loop: "{{ proxmox_certificates }}"
