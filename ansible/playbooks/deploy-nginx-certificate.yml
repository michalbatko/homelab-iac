- name: Deploy certificates to nginx hosts
  hosts: proxy_hosts
  gather_facts: false
  become: yes

  tasks:
    - name: Show execution context
      shell: |
        echo "Hostname: $(hostname)"
        echo "User: $(whoami)"
        echo "Working directory: $(pwd)"
      register: context_info

    - name: Display execution context
      debug:
        var: context_info.stdout_lines

    - name: Create SSL directories
      debug:
        msg: "TODO: Create /etc/nginx/ssl/{{ item.domain }} locally"
      loop: "{{ nginx_certificates }}"

    - name: Copy certificate files
      debug:
        msg: "TODO: Copy /etc/letsencrypt/live/{{ item.domain }}/* from automation host to local /etc/nginx/ssl/{{ item.domain }}/"
      loop: "{{ nginx_certificates }}"

    - name: Set file permissions
      debug:
        msg: "TODO: Set permissions on certificate files for {{ item.domain }}"
      loop: "{{ nginx_certificates }}"

    - name: Reload nginx service
      debug:
        msg: "TODO: Reload nginx locally"
      loop: "{{ nginx_certificates }}"
